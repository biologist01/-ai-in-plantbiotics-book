"use strict";(self.webpackChunkplant_biotech_ai=self.webpackChunkplant_biotech_ai||[]).push([[714],{714(e,n,t){t.r(n),t.d(n,{default:()=>o});var i=t(2444),r=t(3845),s=t(467),a=t(6540),c=t(4848);function o(e){var n=e.isOpen,o=e.onClose,l=(0,a.useState)("idle"),u=l[0],d=l[1],v=(0,a.useState)(!1),h=v[0],x=v[1],p=(0,a.useState)(0),m=p[0],f=p[1],j=(0,a.useState)([]),y=j[0],k=j[1],b=(0,a.useState)(""),g=b[0],N=b[1],w=(0,a.useState)(!1),C=w[0],M=w[1],S=(0,a.useState)(!1),A=S[0],T=S[1],R=(0,a.useState)(0),E=R[0],B=R[1],L=(0,a.useState)(0),W=L[0],D=L[1],P=(0,a.useState)(null),I=P[0],z=P[1],F=(0,a.useRef)(null),V=(0,a.useRef)(null),_=(0,a.useRef)(null),q=(0,a.useRef)(null),H=(0,a.useRef)(null),O=(0,a.useRef)(null),U=(0,a.useRef)(null),G=(0,a.useRef)(null),J=(0,a.useRef)(null);(0,a.useEffect)(function(){var e;null==(e=J.current)||e.scrollIntoView({behavior:"smooth"})},[y,g]),(0,a.useEffect)(function(){var e;return"connected"!==u&&"speaking"!==u&&"listening"!==u&&"processing"!==u||(e=setInterval(function(){q.current&&f(Math.floor((Date.now()-q.current)/1e3))},1e3)),function(){return clearInterval(e)}},[u]);var K=(0,a.useCallback)(function(e,n){try{H.current||(H.current=new AudioContext);var t=H.current,i=t.createAnalyser();i.fftSize=256,t.createMediaStreamSource(e).connect(i),n?O.current=i:U.current=i;var r=new Uint8Array(i.frequencyBinCount),s=function(){i.getByteFrequencyData(r);var e=r.reduce(function(e,n){return e+n},0)/r.length,t=Math.min(e/128,1);n?(B(t),T(t>.1)):(D(t),M(t>.1)),G.current=requestAnimationFrame(s)};s()}catch(a){console.error("Audio visualization error:",a)}},[]),Y=(0,a.useCallback)(function(){G.current&&cancelAnimationFrame(G.current),B(0),D(0)},[]),Q=(0,a.useCallback)(function(){_.current&&(_.current.innerHTML="")},[]),X=(0,a.useCallback)((0,s.A)((0,i.A)().m(function e(){var n,s,a,c,o,l,v,h,x,p,m,j;return(0,i.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if("idle"===u){e.n=1;break}return e.a(2);case 1:if("undefined"!=typeof window){e.n=2;break}return e.a(2);case 2:return z(null),d("connecting"),k([]),N(""),e.p=3,e.n=4,t.e(2223).then(t.bind(t,2223));case 4:return n=e.v,s=n.Room,a=n.RoomEvent,c=n.Track,o=n.createLocalAudioTrack,n.ParticipantEvent,e.n=5,fetch("https://physical-ai-backend-production-1c69.up.railway.app/voice/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_name:"web-user"})});case 5:if((l=e.v).ok){e.n=7;break}return e.n=6,l.text();case 6:throw v=e.v,new Error("Failed to start voice session: "+(v||l.status));case 7:return e.n=8,l.json();case 8:return h=e.v,(x=new s({adaptiveStream:!0,dynacast:!0,audioCaptureDefaults:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).on(a.TrackSubscribed,function(e,n,t){var i;if(e.kind===c.Kind.Audio){var r=e.attach();r.autoplay=!0,r.controls=!1,r.setAttribute("data-lk-remote-audio","true"),null==(i=_.current)||i.appendChild(r);var s=new MediaStream([e.mediaStreamTrack]);K(s,!1)}}),x.on(a.TrackUnsubscribed,function(e){e.detach().forEach(function(e){return e.remove()})}),x.on(a.TranscriptionReceived,function(e,n){for(var t,i=function(){var e=t.value,i=(null==n?void 0:n.identity)!==x.localParticipant.identity?"assistant":"user";e.final?(k(function(n){return[].concat(n,[{id:e.id||Date.now()+"-"+Math.random(),role:i,text:e.text,timestamp:new Date,isFinal:!0}])}),N("")):N(e.text)},s=(0,r.A)(e);!(t=s()).done;)i()}),x.on(a.Disconnected,function(){Q(),Y(),F.current=null,V.current=null,q.current=null,d("idle"),f(0)}),x.on(a.ParticipantConnected,function(e){k(function(e){return[].concat(e,[{id:"system-"+Date.now(),role:"assistant",text:"\ud83c\udf99\ufe0f AI Assistant connected. Start speaking!",timestamp:new Date,isFinal:!0}])})}),e.n=9,x.connect(h.url,h.token);case 9:return F.current=x,q.current=Date.now(),e.n=10,o({echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0});case 10:return p=e.v,V.current=p,e.n=11,x.localParticipant.publishTrack(p);case 11:m=new MediaStream([p.mediaStreamTrack]),K(m,!0),d("connected"),e.n=13;break;case 12:return e.p=12,j=e.v,console.error("Voice call error:",j),z(j instanceof Error?j.message:"Failed to start voice call"),d("idle"),e.n=13,Z();case 13:return e.a(2)}},e,null,[[3,12]])})),[u,Q,Y,K]),Z=(0,a.useCallback)((0,s.A)((0,i.A)().m(function e(){var n,t;return(0,i.A)().w(function(e){for(;;)switch(e.n){case 0:try{if(n=F.current,t=V.current,n&&t){try{n.localParticipant.unpublishTrack(t)}catch(i){}try{t.stop()}catch(r){}}if(n)try{n.disconnect()}catch(s){}}finally{Q(),Y(),F.current=null,V.current=null,q.current=null,d("idle"),f(0),x(!1)}case 1:return e.a(2)}},e)})),[Q,Y]),$=(0,a.useCallback)(function(){var e=V.current;e&&(h?e.unmute():e.mute(),x(!h))},[h]);(0,a.useEffect)(function(){return function(){Z(),H.current&&H.current.close()}},[Z]),(0,a.useEffect)(function(){var e=function(e){"Escape"===e.key&&n&&("idle"!==u&&Z(),o())};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}},[n,u,Z,o]);if(!n)return null;var ee,ne="connected"===u||"speaking"===u||"listening"===u||"processing"===u;return(0,c.jsx)("div",{className:"voice-chat-overlay",children:(0,c.jsxs)("div",{className:"voice-chat-container",children:[(0,c.jsxs)("div",{className:"voice-chat-bg",children:[(0,c.jsx)("div",{className:"voice-orb voice-orb-1",style:{transform:"scale("+(1+.5*W)+")"}}),(0,c.jsx)("div",{className:"voice-orb voice-orb-2",style:{transform:"scale("+(1+.3*W)+")"}}),(0,c.jsx)("div",{className:"voice-orb voice-orb-3",style:{transform:"scale("+(1+.4*E)+")"}})]}),(0,c.jsxs)("div",{className:"voice-chat-header",children:[(0,c.jsx)("button",{className:"voice-back-btn",onClick:function(){Z(),o()},children:(0,c.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7"})})}),(0,c.jsxs)("div",{className:"voice-header-info",children:[(0,c.jsx)("h2",{children:"\ud83c\udf31 Plant AI Voice"}),ne&&(0,c.jsx)("span",{className:"voice-duration",children:(ee=m,Math.floor(ee/60)+":"+(ee%60).toString().padStart(2,"0"))})]}),(0,c.jsxs)("div",{className:"voice-status-indicator",children:[(0,c.jsx)("span",{className:"voice-status-dot "+(ne?"active":"")}),(0,c.jsxs)("span",{className:"voice-status-text",children:["idle"===u&&"Ready","connecting"===u&&"Connecting...",ne&&(C?"AI Speaking":A?"Listening...":"Connected")]})]})]}),(0,c.jsxs)("div",{className:"voice-chat-main",children:[(0,c.jsx)("div",{className:"voice-avatar-container",children:(0,c.jsxs)("div",{className:"voice-avatar "+(C?"speaking":"")+" "+(ne?"connected":""),children:[(0,c.jsxs)("div",{className:"voice-avatar-rings",children:[(0,c.jsx)("div",{className:"voice-ring voice-ring-1",style:{transform:"scale("+(1+.8*W)+")",opacity:.6-.3*W}}),(0,c.jsx)("div",{className:"voice-ring voice-ring-2",style:{transform:"scale("+(1+.5*W)+")",opacity:.4-.2*W}}),(0,c.jsx)("div",{className:"voice-ring voice-ring-3",style:{transform:"scale("+(1+.3*W)+")",opacity:.2-.1*W}})]}),(0,c.jsxs)("div",{className:"voice-avatar-inner",children:[(0,c.jsx)("div",{className:"voice-avatar-icon",children:"connecting"===u?(0,c.jsx)("div",{className:"voice-loading-spinner"}):(0,c.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,c.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",fill:"currentColor",opacity:"0.2"}),(0,c.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,c.jsx)("circle",{cx:"9",cy:"10",r:"1.5",fill:"currentColor"}),(0,c.jsx)("circle",{cx:"15",cy:"10",r:"1.5",fill:"currentColor"}),(0,c.jsx)("path",{d:"M12 2v1M12 21v1M4.22 4.22l.7.7M18.36 18.36l.7.7M2 12h1M21 12h1M4.22 19.78l.7-.7M18.36 5.64l.7-.7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",opacity:"0.3"})]})}),(0,c.jsx)("div",{className:"voice-avatar-label",children:"connecting"===u?"Connecting...":"Plant AI"})]})]})}),(0,c.jsxs)("div",{className:"voice-transcript-container",children:[(0,c.jsxs)("div",{className:"voice-transcript-header",children:[(0,c.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,c.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),(0,c.jsx)("span",{children:"Live Transcript"})]}),(0,c.jsxs)("div",{className:"voice-transcript-content",children:[I&&(0,c.jsxs)("div",{className:"voice-transcript-error",children:[(0,c.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,c.jsx)("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),(0,c.jsx)("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),I]}),0===y.length&&!g&&!I&&(0,c.jsx)("div",{className:"voice-transcript-empty",children:ne?"Start speaking \u2014 your conversation will appear here...":"Click the microphone to start a voice conversation with Plant AI"}),y.map(function(e){return(0,c.jsxs)("div",{className:"voice-transcript-entry "+e.role,children:[(0,c.jsx)("div",{className:"voice-transcript-avatar",children:"assistant"===e.role?"\ud83c\udf31":"\ud83d\udc64"}),(0,c.jsxs)("div",{className:"voice-transcript-bubble",children:[(0,c.jsx)("div",{className:"voice-transcript-text",children:e.text}),(0,c.jsx)("div",{className:"voice-transcript-time",children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},e.id)}),g&&(0,c.jsxs)("div",{className:"voice-transcript-entry user current",children:[(0,c.jsx)("div",{className:"voice-transcript-avatar",children:"\ud83d\udc64"}),(0,c.jsxs)("div",{className:"voice-transcript-bubble",children:[(0,c.jsx)("div",{className:"voice-transcript-text",children:g}),(0,c.jsxs)("div",{className:"voice-transcript-typing",children:[(0,c.jsx)("span",{}),(0,c.jsx)("span",{}),(0,c.jsx)("span",{})]})]})]}),(0,c.jsx)("div",{ref:J})]})]})]}),(0,c.jsxs)("div",{className:"voice-controls",children:[(0,c.jsxs)("div",{className:"voice-user-level",children:[(0,c.jsx)("div",{className:"voice-level-bars",children:[].concat(Array(5)).map(function(e,n){return(0,c.jsx)("div",{className:"voice-level-bar "+(E>.2*(n+1)?"active":""),style:{height:20+8*n+"px"}},n)})}),(0,c.jsx)("span",{className:"voice-level-label",children:h?"Muted":"Your Mic"})]}),(0,c.jsxs)("div",{className:"voice-control-buttons",children:[(0,c.jsx)("button",{className:"voice-control-btn voice-mute-btn "+(h?"muted":""),onClick:$,disabled:!ne,title:h?"Unmute":"Mute",children:h?(0,c.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),(0,c.jsx)("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),(0,c.jsx)("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),(0,c.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,c.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]}):(0,c.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),(0,c.jsx)("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),(0,c.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,c.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),(0,c.jsx)("button",{className:"voice-control-btn voice-call-btn "+(ne?"active":"")+" "+("connecting"===u?"connecting":""),onClick:function(){return ne?void Z():void X()},disabled:"connecting"===u,children:"connecting"===u?(0,c.jsx)("div",{className:"voice-btn-spinner"}):ne?(0,c.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[(0,c.jsx)("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"}),(0,c.jsx)("line",{x1:"1",y1:"1",x2:"23",y2:"23",strokeWidth:"3"})]}):(0,c.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),(0,c.jsx)("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),(0,c.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,c.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),(0,c.jsx)("button",{className:"voice-control-btn voice-speaker-btn",disabled:!ne,title:"Speaker",children:(0,c.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,c.jsx)("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),(0,c.jsx)("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"}),(0,c.jsx)("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"})]})})]}),(0,c.jsx)("div",{className:"voice-tips",children:(0,c.jsx)("span",{children:"\ud83d\udca1 Tip: Ask about plant genetics, ML in agriculture, or any textbook topic!"})})]}),(0,c.jsx)("div",{ref:_,style:{display:"none"}})]})})}}}]);